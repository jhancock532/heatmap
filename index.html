<!DOCTYPE html>
<html>
  <head>
    <title>Map App Demo</title>
    <link rel="stylesheet" href="/heatmap/leaflet.css" />
    <script src="/heatmap/leaflet.js"></script>
    <style>
      html,
      body,
      #map {
        width: 100%;
        height: 100%;
        margin: 0px;
      }

      .number-marker-container {
        width: 20px;
        background-color: #fd5765;
        border-radius: 50%;
      }

      .number-marker {
        width: 100%;
        text-align: center;
        font-size: 1.5rem;
        margin: 0px;
        margin-top: 3px;
        padding: 0px;
        font-family: Apercu Pro, arial, helvetica, sans-serif;
        font-weight: bold;
        color: #ffffff;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>

    const TALLIED_LOCATIONS = {
      "Essex, UK": 1,
      "Liverpool, UK": 1,
      "Leicester, UK": 2,
      "Malvern, UK": 1,
      "Ivybridge, UK": 1,
      "Swansea, UK": 1,
      "Edinburgh, UK": 2,
      "Warrington, UK": 1,
      "Crawley, UK": 1,
      "Newport, UK": 1,
      "Exeter, UK": 1,
      "Leeds, UK": 1,
      "London, UK": 11,
      "Cardiff, UK": 1,
      "Plymouth, UK": 2,
      "Horsham, UK": 1,
      "Derby, UK": 2,
      "Hertfordshire, UK": 1,
      "Stockport, UK": 1,
      "Brighouse, UK": 1,
      "Surrey, UK": 1,
      "Devon, UK": 1,
      "Bude, UK": 1,
      "Droitwich, UK": 1,
      "Nottingham, UK": 1,
      "Birmingham, UK": 1,
      "Manchester, UK": 1,
      "Hayle, UK": 1,
      "Cambridge, UK": 1,
      "Ashford, UK": 1,
      "Llandudno, UK": 1,
      "Brighton, Brighton and Hove, UK": 1,
      "Bristol, UK": 58,
      "Charlbury, Chipping Norton, UK": 28,
      "Manila, Metro Manila, Philippines": 5,
      "Budapest, Hungary": 1,
      "Alberta, Canada": 2,
      "Cuneo, Italy": 1,
      "Brazil": 1,
      "Avignon, France": 1,
      "Assam, India": 1,
      "Limassol, Cyprus": 1,
      "Belgium": 1,
      "Finland": 1,
      "North Carolina, USA": 1,
      "San Luis Obispo, CA, USA": 1
    }



      const highLevelLocations = [
        {
          name: "United Kingdom",
          lat: 51.6,
          lng: -2,
          employees: 116,
        },
      ];

      const lowLevelLocations = [
        {
          name: "Bristol",
          lat: 51.454514,
          lng: -2.58791,
          employees: 43,
        },
        {
          name: "Oxford",
          lat: 51.8745,
          lng: -1.479752,
          employees: 53,
        },
        {
          name: "London",
          lat: 51.509865,
          lng: -0.118092,
          employees: 5,
        },
        {
          name: "Manchester",
          lat: 53.480759,
          lng: -2.242631,
          employees: 10,
        },
        {
          name: "Edinburgh",
          lat: 55.953251,
          lng: -3.188267,
          employees: 5,
        },
      ];

      L.NumberedDivIcon = L.Icon.extend({
        options: {
          iconUrl: null,
          number: "",
          shadowUrl: null,
          iconSize: new L.Point(40, 40),
          iconAnchor: new L.Point(13, 41),
          popupAnchor: new L.Point(6.5, -40),
          className: "number-marker-container",
        },

        createIcon: function () {
          var containerDiv = document.createElement("div");
          var numberDiv = document.createElement("div");
          numberDiv.setAttribute("class", "number-marker");
          numberDiv.innerHTML = this.options["number"] || "";
          containerDiv.appendChild(numberDiv);
          this._setIconStyles(containerDiv, "icon");
          return containerDiv;
        },

        //you could change this to add a shadow like in the normal marker if you really wanted
        createShadow: function () {
          return null;
        },
      });

      var map = L.map("map", {
        minZoom: 0,
        maxZoom: 5,
      }).setView([51.454514, -1.257677], 4);
      L.tileLayer(
        'https://github.com/jhancock532/heatmap/raw/main/tiles/{z}/{x}/{y}.jpg'
      ).addTo(map);

      var lowLevelMarkers = new L.FeatureGroup();
      var highLevelMarkers = new L.FeatureGroup();

      lowLevelLocations.forEach((location) => {
        var marker = new L.Marker([location.lat, location.lng], {
          icon: new L.NumberedDivIcon({ number: location.employees }),
        });

        marker
          .bindPopup(
            `There are ${location.employees} employees in ${location.name}.`
          )
          .openPopup();

        lowLevelMarkers.addLayer(marker);
      });

      highLevelLocations.forEach((location) => {
        var marker = new L.Marker([location.lat, location.lng], {
          icon: new L.NumberedDivIcon({ number: location.employees }),
        });

        marker
          .bindPopup(
            `There are ${location.employees} employees in ${location.name}.`
          )
          .openPopup();

        highLevelMarkers.addLayer(marker);
      });

      map.addLayer(highLevelMarkers);

      map.on("zoomend", function () {
        if (map.getZoom() < 6) {
          map.removeLayer(lowLevelMarkers);
          map.addLayer(highLevelMarkers);
        } else {
          map.addLayer(lowLevelMarkers);
          map.removeLayer(highLevelMarkers);
        }
      });
    </script>
  </body>
</html>
